# 라우터 Router

* 라우터는 네트워크 계층에서 동작하는 장비로 경로를 지정해주는 장비이다.
* 라우터로 패킷이 들어오면 목적지 IP 주소를 확인하고 자신이 가진 경로 (Route) 정보를 이용해 패킷을 최적의 경로로 포워딩한다.
* L3 스위치 역할을 라우터가 하고 있다.  

<br>

## 라우팅 

라우팅은 네트워크에서 경로를 선택하는 프로세스이다. 
라우터가 경로 정보를 얻는 방법은 매우 다양하지만 크게 3가지 방법으로 구분할 수 있다.  

1. 다이렉트 커넥티드
2. 스태틱 라우팅
3. 다이나믹 라우팅

위 3가지 방법을 이용해 경로 정보를 수집하고 수집된 경로 정보 중 목적지에 대한 최적의 경로를 선정해 라우팅 테이블을 만든다.  

<br>

### 다이렉트 커넥티드 Direct Connected

IP 주소를 입력할 때 사용된 IP 주소와 서브넷 마스크로 해당 IP 주소가 속한 네트워크 주소 정보를 알 수 있다.  
라우터나 PC에서는 이 정보를 해당 네트워크에 대한 라우팅 테이블을 자동으로 만들게 되는데 이것을 이 경로 정보를 
**다이렉트 커넥티드**(Direct Connected)라고 한다.  

이 다이렉트 커넥티드로 생성되는 경로 정보는 인터페이스에 IP를 설정하면 자동 생성되는 정보이므로 정보를 강제로
지울 수 없고 해당 네트워크 설정을 삭제하거나 해당 네트워크 인터페이스가 비활성화되어야만 자동으로 사라진다.  

라우팅 테이블을 확인하였더니 목적지가 다이렉트 커넥티드라면 라우터는 L2 통신(ARP 요청을 직접 보내는)으로 
목적지에 도달한다. 목적지가 외부 네트워크인데 다이렉트 커넥티드 라우팅 테이블 정보만 있다면 외부 네트워크와 통신이 불가하다.

<br>

<img alt="라우팅 프로토콜" height="330" src="https://github.com/reddevilmidzy/CS-Study/assets/78539407/81f8ce2d-5360-47e6-af2b-93cab64a48e2"/>

<br>

<br>

### 스태틱 라우팅 Static Routing

관리자가 목적지 네트워크와 넥스트 홉을 라우터에 직접 지정해 경로 정보를 입력하는 것을 **스태틱 라우팅**(Static Routing)이라고 한다. 

* 장점
  * 관리자가 수동으로 경로를 설정하기에 라우터 CPU에 오버헤드가 없다.
  * 네트워크 관리자가 라우팅 동작을 제어하기에 보안상 더 유리한 부분이 있다.
* 단점
  * 네트워크 규모가 증가할 수록 네트워크 관리자의 작업이 더 어려워진다.
  * 라우팅 정보를 입력해야 하기에 네트워크 관리자가 네트워크 구성 정보를 모두 알고 있어야 한다.
  * 네트워크 정보 변경시 네트워크 관리자가 경로를 재설정하기 전까지 방문 불가한 곳이 생길 수 있다.


<br>

### 다이나믹 라우팅 Dynamic Routing

라우터끼리 자신이 알고 있는 경로 정보나 링크 상태 정보를 교환해 전체 네트워크 정보를 학습하여
라우팅 테이블을 상시 자동적으로 생성, 유지하는 라우팅 방식이다.  


* 장점
  * 네트워크 관리자의 라우팅 정책 유지를 위한 작업 리소스가 적다.
  * 네트워크 구성과 상황에 맞게 최적의 경로를 선택할 수 있다. 
  * 경로 손실이 발생하더라도 백업 경로가 있기 때문에 내결함성을 가진다.
* 단점
  * 다른 많은 장비들과 통신하기 위해 스태틱 라우팅에 비해 상대적으로 더 많은 대역폭 소비가 발생한다.

<br>

## 라우팅 프로토콜

인터넷에는 **AS**(Autonomous System)라는 자율 시스템이 존재한다. SKT, KT, LGU+ 같은 인터넷 사업자가
한 개 이상의 AS를 운영한다. 하나의 AS는 하나의 조직이므로 AS 내부에서는 자체적으로 규칙을 세워 운영할 수 있지만
다른 AS와 연결하기 위해서는 내부와 다른 방법으로 정보를 전달해야 한다. AS 내부의 연결은 효율성이 중요하지만
다른 AS와 연결에서는 효율성보다 조직 간 정책이 더 중요하다.


<br>

<img alt="image" height="300" src="https://github.com/reddevilmidzy/CS-Study/assets/78539407/798d79aa-68da-4d7d-8c79-61285106dbfc"/>

<br>


#### IGP(Interior Gateway Protocol)

* 개념: AS 내에서 사용하는 라우팅 프로토콜
* 종류: 
  * **RIP**(Routing Information Protocol)
    * 패킷이 경유할 가능성이 있는 라우터를 홉수 기준으로 최단 경로를 결정
    * 네트워크 주소, IP, 홈수 등의 정보는 라우터 내 DB에 기록되며 정기적으로 정보를 교환하여 업데이트
  *  **OSPF**(Open Shortest Path First)
    * 링크 상태(Link State) 라우팅 프로토콜을 기초로 함
    * 링크 상태의 변화시에만 라우팅 정보를 업데이트
    * RIP와 달리 모든 정보를 갱신하는 것이 아니라 변화된 정보만 갱신


#### EGP(Exterior Gateway Protocol)

* 개념: AS 간 통신에 사용하는 라우팅 프로토콜
* 종류: 
  * **BGP**(Border Gateway Protocol)
    * IGP 보다는 컨버전스 속도면에서 느리지만 대용량의 라우터 정보를 교환하는데 최적
    * TCP 3웨이핸드쉐이크 방식으로 통신


<br>


## 라우팅 알고리즘



<br>

* **라우팅 정보를 취하는 범위에 따라 구분**
  * 글로벌 라우팅 알고리즘
    * ex) 링크 상태 알고리즘
  * 분산 라우팅 알고리즘
    * ex) 거리 벡터 알고리즘

<br>

* **부하에 민감한 정도에 따라 구분**
  * 부하 민감 라우팅 알고리즘
    * ex) 초기 ARPANET
  * 부하 둔감 라우팅 알고리즘
    * ex) RIP, OSPF, BGP 등

<br>

### 글로벌 라우팅 알고리즘

* 네트워크 전체에 대한 완전한 정보를 가지고 출발지와 목적지 사이의 최소 비용 경로를 계산
* 모든 라우터가 연결 상태와 링크 비용을 알고 있다. 
* 링크 상태 알고리즘이 여기에 속하고 **다익스트라 알고리즘**(Dijkstra algorithm)을 사용한다.  


### 분산 라우팅 알고리즘

* 최소 비용 경로의 계산이 라우터들에 의해 반복적이고 분산된 방식으로 수행
* 어떤 라우터도 모든 링크 비용에 대한 완전한 정보를 갖고 있지 않지만, 자신과 인접한 노드의 링크 비용 정보를 알고 있다.
* 거리 벡터 알고리즘이 여기에 속하고 **벨만-포드 알고리즘**(Bellman-Ford algorithm)을 사용한다.  

<br>

---

## 라우팅 테이블

* 라우팅 알고리즘을 통해 찾은 가장 효율적인 경로 정보를 보아두는 테이블
* RAM에 저장되기 때문에 전원 종료시 소실
* 라우터가 패킷을 전송할 때 라우팅 테이블을 참조하여 결정
* 라우팅 테이블의 각 항목의 구성 요소
  * target, prefix-length, next hop, interface

<br>

* 각 라우트에서 32 비트의 IP 주소 중에 실제로 라우팅을 하는데 사용되는 주소 부분의 크기가 Prefix-length이다.
* netId 크기가 24비트인 클래스 C의 IP 주소를 대상으로 라우터 정보를 표현할 때에는 Prefix-length 24가 된다.
* 라우팅 테이블에서 어떤 목적지를 찾아가는 경로를 찾을 때에는 이 Prefix-Length 크기만 비교하여 이 부분이 일치하면 원하는 경로정보를 찾은 것으로 처리하는 것이다.
* 경로를 찾기 위해 라우팅 테이블에서 목적지 주소가 Target인 경로를 찾으면 된다.
* 일치하는 경로를 찾았으면 해당 경로의 Next hop 노드로 패킷을 전송하기 위해 interface 링크로 패킷을 보내면 된다.
* Next Hop에 Target으로 가는데 거쳐야 할 인접 노드의 주소가 적혀있다.
* 이때 목적지인 Target이 Nest hop 라우터와 같은 네트워크에 직접 연결되어 있을 수도 있는데 이때는 Next hop에 목적지가 직접 연결되어 있다는 표시로 directly(다이렉트 커넥티드)가 나타난다.


<br>

## 라우터 구조

라우터는 입력 포트(Input ports) -> 스위칭(패브릭) / 라우팅 프로세서(Routing processor) -> 출력 포트(Output ports)의 구조로 되어 있다. 

라우팅 프로세서가 처리하는 관리 제어 측면을 라우팅이라고 하고, 입출력 포트와 스위칭을 활용하는 것이 데이터적인 측면, 포워딩이라고 한다. 


### Input port

입력 포트의 구조는 아래와 같다.  

```text
+----------+       +-------- ------+       +-------+  
| 물리 계층 | ----> | 데이터링크 계층 | ----> | queue | ---> (fabric)  
|  프로세서 |       |    프로세서    |       |       |  
+----------+       +---------------+       +-------+  
```

<br>

### Output port

입력 포트를 뒤집은 모양이다.  

```text
+--------+       +----------+       +---------------+
| queue  | ----> | 물리 계층 | ----> | 데이터링크 계층 | ---> 외부
|        |       |  프로세서 |       |    프로세서    |
+--------+       +----------+       +---------------+
```

<br>

---


## 포워딩 Forwarding

포워딩은 라우터의 입력 포트에서 출력 포트로 패킷을 이동시키는 것을 말한다.

<br>

### 포워딩 방법

* 라우터는 입력 링크 측으로부터 수신된 패킷의 헤더 부분에서 IP 주소 추출
* 추출된 IP 주소를 라우팅 테이블과 비교
* 어느 포트에 연결된 링크로 보낼지 결정
* 새로운 헤더 정보를 붙여서 다음 라우터로 전달

<br>

### 포워딩 테이블

* 입력 포트의 수신 패킷을 어느 출력 포트로 보낼 것인가를 나타낸 테이블
* 스위치 및 라우터 장비 모두가 포워트 테이블을 관리

<br>

## 라우팅과 포워딩

* 라우팅
  * 출발지에서 목적지까지 경로를 설정하는 것
  * 라우팅 알고리즘을 사용하여 최적인 경로를 계산
  * 제어 평면에 구현된 기능
  * 포워딩보다 더 긴 시간이 소요되며 소프트웨어에서 실행됨

* 포워딩
  * 라우터의 입력 포트에서 출력 포트로 패킷을 이동시키는 것
  * 데이터 평면에 구현된 기능
  * 매우 짧은 시간안에 수행되며, 하드웨어에서 실행됨

<br>

#### ref
[IT 엔지니어를 위한 네트워크 입문](https://www.gilbut.co.kr/book/view?bookcode=BN002885)  
[라우팅 vs 포워딩](https://velog.io/@yh_lee/%EB%9D%BC%EC%9A%B0%ED%8C%85-vs-%ED%8F%AC%EC%9B%8C%EB%94%A9)  
[컴퓨터네트워크 04 : Network Layer](https://velog.io/@yiwonjin/%EC%BB%B4%ED%93%A8%ED%84%B0%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-04-Network-Layer)  
[3.라우팅(포워딩, 링크상태 라우팅,...)](https://hyeophyeop.tistory.com/69)  
[정적 라우팅, 고정 라우팅](http://www.ktword.co.kr/test/view/view.php?m_temp1=668)  
[Routing Table, Forwarding Table 라우팅 테이블, 포워딩 테이블](http://www.ktword.co.kr/test/view/view.php?m_temp1=1327)  
