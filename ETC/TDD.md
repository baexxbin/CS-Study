# TDD (test-driven development)

<br/>

## TDD이란?

**선 테스트 후 개발 방식의 프로그래밍 방법인 테스트 주도 개발.**
- `테스트가 개발을 이끌어 나간다`
- 반복 테스트를 이용한 소프트웨어 방법론
    - 작은 단위의 테스트 케이스를 작성하고 이를 통과하는 코드를 추가하는 단계를 반복하여 구현함
- 매주 짧은 개발 사이클의 반복에 의존하는 소프트웨어 개발 프로세스
    - 애자일 방법론 중 하나인 eXtream Programming(XP)의 `Test-First` 개념에 기반을 둔 단순한 설계를 중요시함
    - `TDD = TFD(Test-First Development) + Refactoring`

> **eXtream Programming(XP)**
>  - 미래에 대한 예측을 최대한 하지 않고 지속적으로 프로토타입을 완성하는 애자일 방법론 중 하나
>  - 추가 요구 사항이 생겨도 실시간으로 반영 가능

### 테스트 코드를 먼저 작성해야 하는 이유

1. 깔끔한 코드를 작성할 수 있다. (궁극적인 목표)
  - TDD의 개발 단계 중 리팩토링 과정을 거치면서 중복되는 코드들이 제거되고, 복잡한 코드들이 깔끔하게 정리됨
2. 장기적으로 개발 비용을 절감할 수 있다.
3. 개발이 끝나고 테스트 코드를 작성하는 것은 매우 귀찮다.
    - 테스트 코드는 성공뿐만 아니라 실패 케이스도 작성해야 하기 떄문에 이미 프로덕션 코드를 작성하였다면 테스트 코드를 작성하는 것이 꺼려진다.

> + 테스트 코드를 작성할 때 성공보다는 실패 테스트부터 작성해야 한다.

<br/>

## 단위 테스트와 통합 테스트


### 단위 테스트(Unit Test)란?

**개념**
- 하나의 모듈을 기준으로 독립적으로 진행되는 가장 작은 단위의 테스트
    - 모듈 = 애플리케이션에서 자동하는 하나의 기능 또는 메서드
- 애플리케이션을 구성하는 하나의 기능이 올바르게 동작하는 지를 독립적으로 테스트하는 것

**필요성**
- 통합 테스트는 실제 여러 컴포턴트들 간의 상호작용을 테스트하기 때문에 모든 컴포넌트들이 구동된 상태에서 진행됨
    - 통합 테스트를 하려면 다른 컴포넌트와 연결해야하고, 시스템을 구성하는 컴포넌트들이 많아질수록 테스트를 위한 비용(시간)이 상당히 커짐
- 단위 테스트는 해당 부분만 독립적으로 테스트하기 떄문에 어떤 코드를 리팩토링하여도 빠르게 문제 여부를 확인할 수 있음
- 개발 및 테스팅에 대한 시간과 비용을 절감할 수 있음
- 새로운 기능 추가 및 수정 시에 수시로 빠르게 테스트 할 수 있음
- 리팩토링 시에 안정성을 확보할 수 있음

**보통 실무에서 테스트 코드를 작성한다면 거의 단위 테스트를 의미함 + 단위 테스트를 선호함**
- TDD에서 말하는 테스트도 단위 테스트를 의미함
- 직접 작성한 테스트 코드를 수시로 빠르게 돌리면서 문제를 파악할 수 있음


<br/>

### 통합 테스트(Integration Test)란?

- 모듈을 통합하는 과정에서 모듈 간의 호환성을 확인하기 위해 수행되는 테스트
    - 일반적으로 애플리케이션은 여러 개의 모듈들로 구성이 되고, 서로 메시지를 주고 받으면서 기능을 수행함
    - 통합된 모듈들이 올바르게 연계되어 동작하는 검증을 목적으로 진행되는 테스트가 통합 테스트


<br/>


## 추가) 좋은 테스트의 특징

> 좋은 테스트 코드는 FIRST라는 5가지 규칙을 따름(`CleanCode` 참고)  
> 빠르게 독립적으로 어느 환경에서든 실행이 가능하고 검증할 수 있어야 한다.

1. `Fast`: 테스트는 빠르게 동작하여 자주 돌릴 수 있어야 한다.
2. `Independent`: 각각의 테스트는 독립적이며 서로 의존해서는 안된다.
3. `Repeatable`: 어느 환경에서도 반복 가능해야 한다(항상 같은 결과를 반환).
4. `Self-Validating`: 테스트는 성공 또는 실패로 bool값을 결과를 내어 자체적으로 검증되어야 한다.
    - `JUnit`에서 제공하는 `assert`와 같은 검증 코드 이용
5. `Timely`: 테스트는 적시에 즉, 테스트하려는 실제 코드를 구현하기 직전에 구현해야 한다.
    - 테스트 코드를 실제 코드(프로덕션 코드)보다 먼저 작성해야 한다.

<br/>

### + 좋은 단위 테스트의 특징

1. 1개의 테스트 함수에 대해 `assert`를 최소화해야 한다.
2. 1개의 테스트 함수는 1가지 개념 만을 테스트해야 한다.

<br/>

## TDD 개발주기

<img src="https://hanamon.kr/wp-content/uploads/2021/04/TDD-%E1%84%80%E1%85%A2%E1%84%87%E1%85%A1%E1%86%AF%E1%84%8C%E1%85%AE%E1%84%80%E1%85%B5.png" width="440" height="300"/>

- 🔴 Red 단계: 실패하는 테스트 코드를 먼저 작성한다.
    - 구현해야 할 기능에 대한 테스트를 작성하고, 테스트를 수행함
    - 처음 작성한 테스트는 무조건 실패해야 함
        - 해당 테스트를 구현한 코드가 아직 존재하거나 변경되지 않았기 때문
- 🟢 Green 단계: 테스트 코드를 성공시키기 위한 실제 코드를 작성한다.
    - 추가된 테스트를 반영하여 구현 코드를 작성할 때는 테스트 성공을 위해 최소한의 코드 변경만 존재해야 함
        - TDD에서는 테스트 성공을 위해 최소한의 코드만 추가되거나 변경되어야 함
        - 추가된 테스트에 대해서만 메인 코드가 작성되어야 부작용이 적음
- 🔵 Blue 단계: 중복 코드 제거, 일반화 등의 리팩토링을 수행한다.
    - 설계를 개선함



> 중요한 것은 실패하는 테스트 코드를 작성할 때까지 실제 코드를 작성하지 않는 것과 실패하는 테스트를 통과할 정도의 최소 실제 코드를 작성해야하는 것이다. 이를 통해 실제 코드에 대해 기대되는 바를 보다 명확하게 정의 함으로써 **불필요한 설계를 피할 수 있고**, **정확한 요구사항에 집중**할 수 있다.


<br/>


## TDD와 일반 개발 과정과의 차이점


### ➡️ 일반 개발 방식

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcXoUol%2FbtqBWrI2z2l%2FezsoBHstfTXgZfzGKQzOwK%2Fimg.png" width="440" height="100"/>

`요구사항 분석 ➡ 설계 ➡ 개발 ➡ 테스트 ➡ 배포` 형태의 개발 주기를 가짐
- **이러한 방식은 소트프웨어 개발을 느리게 하는 잠재적 위험이 존재**
    - 소비자의 요구사항이 처음부터 명확하지 않을 수 있음
    - 따라서 처음부터 완벽한 설계가 어려움
    - 자체 버그 검출 능력 저하 또는 소스코드의 품질이 저하될 수 있음
    - 자체 테스트 비용이 증가할 수 있음
- **어느 프로젝트든 초기 설계가 완벽할 수 없기 때문에 위의 문제점이 발생함**
    - 보통은 고객의 요구사항이나 외부 또는 내부 조건에 의해 재설계하여 점진적으로 완벽한 설계로 나아감
    - 재설계로 인해 개발자는 코드를 삽입, 수정, 삭제하는 과정에서 **불필요한 코드가 남거나** **중복처리** 될 가능성이 큼
- **이러한 코드들은 재사용이 어렵고 관리가 어려워서 유지보수를 어렵게 만듦**
    - 작은 부분의 기능 수정에도 모든 부분을 테스트해야 하기 때문에 전체적인 버그를 검출하기 어려워짐(자체 버그 검출 능력 저하)
    - 이로 인해 버그가 어디서 생길지 몰라 잘못도니 코드도 방치하는 일이 생김(소스 코드의 품질 저하)


<br/>


### 🔄 TDD 개발방식

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fn7tzF%2FbtqBYtFtylr%2FPNz12MTxKTiEblbhdCCDKK%2Fimg.png" width="450" height="150"/>

`단위 테스트 작성 → 단위 테스트 실행 → 운영 코드 작성 → 단위 테스트 실행 → 설계 개선(리팩토링) → 단위 테스트 실행`
- **테스트 코드를 작성한 뒤에 실제 코드를 작성함**(일반적인 개발 방식과 가장 큰 차이점)
    - `디자인(설계) 단계`에서 프로그래밍 목적을 반드시 미리 정의해야 하고, 무엇을 테스트해야 할지 미리 정의(테스트 케이스 작성)해야 함
    - `테스트 코드 작성 단계`에서 발생하는 예외 사항은 테스트 케이스에 추가하고 설계를 개선(`리팩토링 단계`)함
    - 이후 테스트가 통과된 코드만을 `코드 개발 단계`에서 실제 코드로 작성함
- **이러한 단계가 반복되면서 자연스럽게 코드의 버그가 줄어들고 소스코드는 간결해짐**
    - 테스트 케이스 작성으로 인해 자연스럽게 설계가 개선되어 재설계 시간이 절감됨

<br/>


#### TDD의 효과(장점)

- 높은 코드 안전성(객체 지향적인 코드)
    - TDD는 코드 재사용 보장을 명시하므로 TDD를 통한 소프트웨어 개발 시, 기능별로 철저한 모듈화가 이루어짐
    - 종속성과 의존성이 낮은 모듈로 조합된 소프트웨어 개발을 가능하게 함
    - 필요에 따라 모듈을 추가하거나 제거해도 소프트웨어 전체 구조에 영향을 미치지 않게 됨
- 재설계 시간의 단축
    - 테스트 코드를 먼저 작성하기 때문에 개발자가 무엇을 해야하는지 정의하고 개발을 시작함
    - 테스트 시나리오를 작성하면서 다양한 예외사항에 대해 생각해볼 수 있음
    - 이는 완성도 높은 설계로 이어져 추후 설계가 변경되는 일을 방지할 수 있음
- 디버깅 시간 단축
    - 단위 테스트의 이점이기도 함
    - 모듈 별로 테스트를 자동화하지 않으면 모든 레벨의 코드를 살펴봐야 함
    - TDD는 자동화된 유닛테스팅을 전해하므로 특정 버그를 손쉽게 찾을 수 있음
- 테스트 문서의 대체
    - 주로 SI 프로젝트에서 테스트 정의서를 만드는데, 이는 단순 통합 테스트 문서임
    - TDD를 하면, 테스팅을 자동화 시킴과 동시에 보다 정확한 테스트 근거를 산출할 수 있음
- 추가 구현에 용이함
    - 자동화된 유닛 테스팅을 전제하므로 테스트 시간을 획기적으로 단축시킬 수 있음

<br/>


#### TDD의 단점

- 생산성 저하(가장 큰 단점)
    - TDD 방식의 개발 시간은 일반적인 개발 방식에 비해 10~30% 정도 늘어남
        - 처음부터 프로덕션과 테스트 코드 2개를 작성하고, 중간에 계속해서 고쳐나가야 함
    - 단순 개발이나 단발성 프로젝트의 경우, 개발 기간이 짧아 TDD를 적용하기에 비효율적일 수 있음(ex. SI 프로젝트)
- 자신이 개발하던 방식을 많이 바꾸어야 함
- 구조에 얽매임
    - 반드시 툴(단위 테스트 프레임워크)을 써서 개발해야 한다고 생각함
    - 규칙에 얽매이는 것은 애자일 방식이 아니며, 이 때문에 똑같은 테스트를 복붙함


<br/>


#### + TDD의 대표적인 Tool 'JUnit'
- 현재 전 세계적으로 가장 널리 사용되는 `Java 단위 테스트 프레임워크`
    - JUnit을 시작으로 CUnit(C언어), CPPUnit(C++), PyUnit(Python) 등 xUnit 프레임워크가 탄생함
- `given-when-then` 패턴
    - 1개의 단위 테스트를 3가지 단계로 나누어 처리하는 패턴으로, 요즘 단위 테스트에서 많이 작성함
        - given(준비): 어떠한 데이터가 준비되었을 때
        - when(실행): 어떠한 함수를 실행하면
        - then(검증): 어떠한 결과가 나와야 한다.


#### + Spring의 단위 테스트 'Mockito'
- 개발자가 동작을 직접적으로 제어할 수 있는 가짜 객체를 지원하는 테스트 프레임워크
- Spring 어플리케이션은 여러 객체들 간의 의존성이 생기는데 이러한 의존성을 `Mockito`를 이용하여 단절 시킴으로 단위 테스트를 쉽게 작성하는 것을 도움
- JUnit과 같이 자주 쓰임.


<br/>


---

**참고**

https://hanamon.kr/tdd%EB%9E%80-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C/

https://inpa.tistory.com/entry/QA-%F0%9F%93%9A-TDD-%EB%B0%A9%EB%B2%95%EB%A1%A0-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C
